<html ng-app="sampleApp">
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.0-beta.17/angular.min.js"></script>
        <script src="https://cdn.firebase.com/js/client/1.0.18/firebase.js"></script>
        <script src="https://cdn.firebase.com/js/simple-login/1.6.3/firebase-simple-login.js"></script>
        <script src="https://cdn.firebase.com/libs/angularfire/0.8.0/angularfire.min.js"></script>
    </head>
    <body>
        <div ng-controller="formCtrl">
        <!-- push a new message into the array -->
            <form ng-submit="checkPostalCode(postalCode, address)">
                <table>
                    <tr>
                        <td>
                            Postal Code:
                        </td>
                        <td>
                            <input ng-model="postalCode" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Address:
                        </td>
                        <td>
                            <input ng-model="address" />
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <button type="submit">Check Availability</button>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <script>
                                var msg;
                                document.write(msg);
                            </script>
                        </td>
                    </tr>
                </table>
            </form>
            <form ng-submit="createAccount(email, password, password2, name)">
                <table>
                    <tr>
                        <td>
                            Email:
                        </td>
                        <td>
                            <input ng-model="email" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Password:
                        </td>
                        <td>
                            <input type="password" ng-model="password" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Re-enter Password:
                        </td>
                        <td>
                            <input type="password" ng-model="password2" />
                        </td>
                    </tr>
                    <tr>
                        <td>
                            Name:
                        </td>
                        <td>
                            <input ng-model="name" />
                        </td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>
                            <button type="submit">Submit</button>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <script>
                                var message = '';
                                document.write(message);
                            </script>
                        </td>
                    </tr>
                </table>
            </form>
        </div>
        <script>
          
            var postalCode = localStorage.getItem('postalcode');
            //var packages = localStorage.getItem('packages');
            
            var app = angular.module("sampleApp", ["firebase"]);
            var address = "http://uakk8c74aebe.amandalee2012.koding.io/Assignment2/";
            app.controller("formCtrl", function($scope, $firebase) {
                var ref = new Firebase("https://assignment-2.firebaseio.com/");
                var sync = $firebase(ref);
                $scope.unavailarea = sync.$asArray();
                
                $scope.checkPostalCode = function(postalCode) {
                    var area = postalCode.substring(0,2);
                    //$scope.unavailarea.$add({unavailarea: area});   
                    if(area==01||area==02||area==03||area==04||area==05||area==06) {
                        
                        msg = 'Delivery is available to your address!';
                        //Go next page
                        localStorage.setItem('postalcode', postalCode);
                        localStorage.setItem('address', address);
                        
                    } else {
                        
                        var usersRef = ref.child("unavailarea");
                        usersRef.push({unavailarea: area});
                        msg = 'We currently do not deliver to your area. TOO BAD TOO SAD';
                        
                    }
                }
                
                $scope.createAccount = function(email, password, password2, name) {
                    
                    if(email!=''&&password!=''&&password2!=''&&name!=''&&address!='') {
                        if(password!=password2) {
                            message = 'Passwords do not match';
                        } else {
                            var usersRef = ref.child("useracct");
                            usersRef.push({
                                email: email,
                                password: password,
                                name: name,
                                address: localStorage.getItem('address'),
                                postalCode: localStorage.getItem('postalCode'),
                                //packages: packages
                            });
                        }
                    } else {
                       message = 'Please fill in all fields';
                    }
                }
            });
          
        </script>
    <p>
        <script>
            // document.write(postalCode);
        </script>
    </p>
    </body>
</html>